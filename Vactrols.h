#ifndef VACTROLS_H
#define VACTROLS_H

#include <Arduino.h>
#include <SPI.h>
#include "MCP4261.h"

#include "Preset.h"

#define ADDRESS 0x11

#define LOOKUP_PWM_IDX 1
#define LOOKUP_POT_IDX 0

#define TREBLE_POT_CS 24
#define TREBLE_PWM1_PIN 11
#define TREBLE_PWM2_PIN 12

#define MID_POT_CS 23
#define MID_PWM1_PIN 9
#define MID_PWM2_PIN 10

#define BASS_POT_CS 22
#define BASS_PWM1_PIN 7
#define BASS_PWM2_PIN 8

#define VOLUME_POT_CS 25
#define VOLUME_PWM1_PIN 13

class Vactrols
{
public:
	// Constructor
	Vactrols();

	void ApplyPreset(Preset &preset);

	void SetBass(int value);
	void SetMiddle(int value);
	void SetTreble(int value);
	void SetVolume(int value);

private:
	void setDoubleVactrol(int value, MCP4261 &digipot, int pwm1Pin, int pwm2Pin, int vactrolLookup[256][2]);

	MCP4261 bassPot;
	MCP4261 midPot;
	MCP4261 treblePot;

	int VolumeLookup[256][2] = {
		{243, 255},
		{243, 255},
		{76, 255},
		{109, 254},
		{69, 252},
		{84, 247},
		{80, 248},
		{32, 251},
		{53, 247},
		{30, 245},
		{31, 248},
		{29, 244},
		{114, 211},
		{49, 230},
		{41, 236},
		{105, 196},
		{7, 250},
		{9, 248},
		{11, 243},
		{16, 240},
		{77, 184},
		{24, 224},
		{9, 242},
		{4, 249},
		{27, 216},
		{83, 162},
		{44, 188},
		{54, 184},
		{87, 148},
		{16, 226},
		{10, 234},
		{55, 168},
		{73, 143},
		{124, 67},
		{25, 194},
		{81, 111},
		{48, 153},
		{26, 193},
		{24, 191},
		{73, 100},
		{95, 76},
		{11, 221},
		{47, 130},
		{52, 117},
		{38, 153},
		{7, 227},
		{37, 143},
		{93, 42},
		{43, 121},
		{20, 177},
		{9, 214},
		{12, 202},
		{57, 75},
		{48, 94},
		{8, 215},
		{29, 256},
		{13, 192},
		{19, 169},
		{41, 105},
		{28, 136},
		{46, 79},
		{24, 140},
		{39, 92},
		{40, 91},
		{39, 91},
		{8, 207},
		{48, 0},
		{10, 191},
		{34, 102},
		{56, 27},
		{41, 63},
		{49, 41},
		{52, 24},
		{54, 28},
		{41, 61},
		{39, 61},
		{35, 81},
		{4, 221},
		{49, 12},
		{52, 3},
		{33, 73},
		{44, 37},
		{8, 256},
		{38, 46},
		{47, 9},
		{7, 193},
		{29, 72},
		{16, 139},
		{10, 174},
		{15, 144},
		{19, 122},
		{24, 90},
		{27, 77},
		{37, 18},
		{37, 30},
		{3, 221},
		{6, 194},
		{37, 16},
		{25, 75},
		{24, 75},
		{36, 18},
		{13, 137},
		{21, 80},
		{29, 41},
		{16, 108},
		{27, 48},
		{8, 167},
		{32, 14},
		{20, 81},
		{5, 196},
		{3, 214},
		{12, 131},
		{22, 62},
		{24, 55},
		{6, 184},
		{29, 24},
		{8, 162},
		{24, 44},
		{2, 225},
		{5, 185},
		{18, 78},
		{8, 160},
		{16, 92},
		{2, 223},
		{26, 17},
		{15, 0},
		{16, 83},
		{25, 28},
		{2, 221},
		{21, 46},
		{24, 27},
		{13, 102},
		{23, 28},
		{14, 96},
		{4, 192},
		{8, 146},
		{18, 61},
		{16, 76},
		{3, 202},
		{13, 96},
		{19, 41},
		{2, 216},
		{8, 141},
		{14, 83},
		{13, 90},
		{12, 95},
		{11, 107},
		{10, 111},
		{10, 117},
		{3, 198},
		{11, 98},
		{5, 168},
		{21, 12},
		{16, 48},
		{12, 91},
		{17, 39},
		{20, 14},
		{20, 16},
		{17, 38},
		{9, 118},
		{9, 116},
		{4, 181},
		{4, 180},
		{6, 151},
		{6, 150},
		{3, 194},
		{7, 134},
		{16, 32},
		{4, 175},
		{18, 10},
		{2, 210},
		{15, 40},
		{17, 5},
		{2, 209},
		{7, 127},
		{4, 169},
		{10, 93},
		{10, 89},
		{9, 103},
		{3, 186},
		{15, 3},
		{15, 25},
		{6, 138},
		{8, 109},
		{13, 2},
		{8, 103},
		{16, 14},
		{4, 167},
		{14, 36},
		{15, 23},
		{1, 227},
		{15, 22},
		{9, 87},
		{5, 149},
		{13, 35},
		{5, 147},
		{0, 227},
		{3, 181},
		{5, 143},
		{12, 47},
		{5, 141},
		{6, 125},
		{14, 15},
		{13, 21},
		{9, 84},
		{4, 157},
		{12, 34},
		{8, 92},
		{6, 123},
		{5, 137},
		{3, 177},
		{9, 74},
		{13, 19},
		{3, 175},
		{6, 121},
		{7, 99},
		{13, 14},
		{0, 223},
		{3, 172},
		{12, 22},
		{2, 197},
		{5, 135},
		{6, 110},
		{11, 34},
		{5, 133},
		{8, 79},
		{10, 50},
		{2, 195},
		{9, 63},
		{7, 93},
		{4, 150},
		{11, 5},
		{7, 92},
		{4, 148},
		{10, 3},
		{11, 6},
		{4, 145},
		{9, 57},
		{9, 56},
		{0, 219},
		{3, 166},
		{4, 141},
		{8, 68},
		{9, 49},
		{6, 102},
		{2, 188},
		{10, 34},
		{8, 61},
		{1, 218},
		{3, 164},
		{4, 138},
		{4, 137},
		{5, 120},
		{3, 162},
		{5, 118},
	};

	int TrebleLookup[256][2] = {
		{243, 255},
		{84, 247},
		{31, 248},
		{105, 196},
		{77, 184},
		{83, 162},
		{10, 234},
		{81, 111},
		{95, 76},
		{7, 227},
		{9, 214},
		{29, 256},
		{46, 79},
		{8, 207},
		{41, 63},
		{39, 61},
		{33, 73},
		{7, 193},
		{19, 122},
		{3, 221},
		{36, 18},
		{27, 48},
		{3, 214},
		{29, 24},
		{18, 78},
		{15, 0},
		{24, 27},
		{8, 146},
		{19, 41},
		{12, 95},
		{11, 98},
		{17, 39},
		{9, 116},
		{3, 194},
		{2, 210},
		{4, 169},
		{15, 3},
		{8, 103},
		{1, 227},
		{5, 147},
		{5, 141},
		{4, 157},
		{3, 177},
		{7, 99},
		{2, 197},
		{8, 79},
		{4, 150},
		{11, 6},
		{3, 166},
		{2, 188},
		{4, 138},
		{7, 73},
		{7, 72},
		{9, 38},
		{4, 132},
		{4, 129},
		{8, 40},
		{6, 81},
		{8, 35},
		{5, 97},
		{2, 175},
		{8, 30},
		{8, 6},
		{0, 209},
		{1, 207},
		{1, 206},
		{1, 205},
		{3, 135},
		{6, 48},
		{3, 134},
		{4, 102},
		{2, 163},
		{3, 126},
		{5, 65},
		{1, 202},
		{2, 157},
		{6, 6},
		{6, 24},
		{1, 199},
		{5, 54},
		{3, 117},
		{2, 152},
		{4, 80},
		{2, 151},
		{0, 196},
		{2, 148},
		{3, 105},
		{2, 144},
		{0, 193},
		{0, 192},
		{5, 7},
		{5, 22},
		{1, 189},
		{0, 189},
		{3, 2},
		{2, 137},
		{4, 55},
		{3, 89},
		{3, 88},
		{2, 134},
		{3, 86},
		{1, 185},
		{2, 130},
		{3, 84},
		{4, 41},
		{1, 182},
		{2, 125},
		{0, 183},
		{0, 182},
		{3, 3},
		{4, 27},
		{0, 180},
		{0, 179},
		{4, 9},
		{4, 16},
		{2, 115},
		{0, 176},
		{3, 67},
		{3, 65},
		{1, 175},
		{2, 2},
		{1, 174},
		{1, 173},
		{2, 112},
		{2, 109},
		{2, 108},
		{0, 172},
		{3, 54},
		{1, 169},
		{0, 171},
		{2, 103},
		{3, 45},
		{3, 44},
		{2, 101},
		{1, 166},
		{3, 41},
		{0, 166},
		{3, 40},
		{0, 165},
		{0, 164},
		{3, 39},
		{1, 164},
		{2, 91},
		{0, 163},
		{3, 26},
		{2, 89},
		{2, 88},
		{3, 15},
		{1, 159},
		{2, 87},
		{0, 161},
		{0, 159},
		{2, 86},
		{0, 158},
		{2, 83},
		{1, 2},
		{0, 157},
		{0, 156},
		{0, 155},
		{2, 4},
		{1, 153},
		{0, 154},
		{0, 153},
		{2, 74},
		{2, 74},
		{0, 152},
		{1, 152},
		{2, 72},
		{1, 151},
		{1, 151},
		{1, 149},
		{0, 151},
		{0, 151},
		{0, 150},
		{1, 147},
		{2, 61},
		{0, 149},
		{0, 148},
		{0, 148},
		{1, 144},
		{0, 147},
		{2, 59},
		{0, 145},
		{2, 6},
		{0, 144},
		{1, 142},
		{0, 143},
		{0, 142},
		{2, 55},
		{2, 54},
		{0, 141},
		{1, 140},
		{2, 50},
		{2, 50},
		{1, 139},
		{1, 139},
		{0, 140},
		{2, 47},
		{2, 47},
		{2, 44},
		{2, 43},
		{0, 138},
		{0, 138},
		{0, 136},
		{1, 133},
		{2, 42},
		{2, 10},
		{0, 134},
		{0, 134},
		{1, 132},
		{0, 133},
		{0, 133},
		{0, 132},
		{2, 15},
		{2, 29},
		{0, 131},
		{0, 131},
		{2, 13},
		{0, 130},
		{0, 130},
		{1, 127},
		{1, 127},
		{0, 129},
		{0, 129},
		{1, 126},
		{1, 126},
		{1, 126},
		{0, 127},
		{0, 127},
		{1, 123},
		{0, 126},
		{0, 126},
		{0, 124},
		{0, 124},
		{0, 124},
		{1, 121},
		{1, 121},
		{1, 121},
		{0, 122},
		{0, 121},
		{0, 121},
		{1, 120},
		{1, 120},
		{1, 120},
		{0, 120},
		{0, 120},
		{0, 120},
		{1, 118},
		{1, 118},
		{0, 119},
		{1, 115},
		{1, 115},
		{1, 115},
		{1, 115},
		{0, 118},
	};

	int BassMiddleLookup[256][2] = {
		{243, 255},
		{76, 255},
		{69, 252},
		{80, 248},
		{53, 247},
		{31, 248},
		{114, 211},
		{41, 236},
		{7, 250},
		{11, 243},
		{77, 184},
		{9, 242},
		{27, 216},
		{44, 188},
		{87, 148},
		{10, 234},
		{73, 143},
		{25, 194},
		{48, 153},
		{24, 191},
		{95, 76},
		{47, 130},
		{38, 153},
		{37, 143},
		{43, 121},
		{9, 214},
		{57, 75},
		{8, 215},
		{13, 192},
		{41, 105},
		{46, 79},
		{39, 92},
		{39, 91},
		{48, 0},
		{34, 102},
		{41, 63},
		{52, 24},
		{41, 61},
		{35, 81},
		{49, 12},
		{33, 73},
		{8, 256},
		{47, 9},
		{29, 72},
		{10, 174},
		{19, 122},
		{27, 77},
		{37, 30},
		{6, 194},
		{25, 75},
		{36, 18},
		{21, 80},
		{16, 108},
		{8, 167},
		{20, 81},
		{3, 214},
		{22, 62},
		{6, 184},
		{8, 162},
		{2, 225},
		{18, 78},
		{16, 92},
		{26, 17},
		{16, 83},
		{2, 221},
		{24, 27},
		{23, 28},
		{4, 192},
		{18, 61},
		{3, 202},
		{19, 41},
		{8, 141},
		{13, 90},
		{11, 107},
		{10, 117},
		{11, 98},
		{21, 12},
		{12, 91},
		{20, 14},
		{17, 38},
		{9, 116},
		{4, 180},
		{6, 150},
		{7, 134},
		{4, 175},
		{2, 210},
		{17, 5},
		{7, 127},
		{10, 93},
		{9, 103},
		{15, 3},
		{6, 138},
		{13, 2},
		{16, 14},
		{14, 36},
		{1, 227},
		{9, 87},
		{13, 35},
		{0, 227},
		{5, 143},
		{5, 141},
		{14, 15},
		{9, 84},
		{12, 34},
		{6, 123},
		{3, 177},
		{13, 19},
		{6, 121},
		{13, 14},
		{3, 172},
		{2, 197},
		{6, 110},
		{5, 133},
		{10, 50},
		{9, 63},
		{4, 150},
		{7, 92},
		{10, 3},
		{4, 145},
		{9, 56},
		{3, 166},
		{8, 68},
		{6, 102},
		{10, 34},
		{1, 218},
		{4, 138},
		{5, 120},
		{5, 118},
		{5, 116},
		{5, 114},
		{7, 72},
		{8, 56},
		{10, 12},
		{10, 16},
		{9, 35},
		{4, 132},
		{7, 2},
		{5, 106},
		{7, 68},
		{1, 214},
		{8, 40},
		{7, 61},
		{1, 213},
		{0, 214},
		{5, 102},
		{8, 35},
		{9, 13},
		{8, 4},
		{1, 211},
		{0, 212},
		{2, 175},
		{1, 210},
		{0, 211},
		{6, 68},
		{1, 209},
		{8, 6},
		{2, 171},
		{3, 139},
		{8, 11},
		{3, 137},
		{1, 207},
		{0, 208},
		{7, 36},
		{6, 61},
		{0, 207},
		{1, 205},
		{6, 57},
		{0, 206},
		{5, 79},
		{4, 105},
		{6, 48},
		{5, 76},
		{5, 2},
		{7, 24},
		{0, 204},
		{4, 102},
		{4, 101},
		{4, 100},
		{3, 128},
		{0, 202},
		{3, 126},
		{3, 125},
		{2, 161},
		{5, 64},
		{2, 159},
		{1, 202},
		{4, 88},
		{5, 63},
		{3, 121},
		{2, 156},
		{6, 6},
		{4, 87},
		{5, 60},
		{0, 200},
		{5, 58},
		{1, 199},
		{0, 199},
		{4, 2},
		{4, 84},
		{5, 52},
		{3, 117},
		{1, 197},
		{3, 115},
		{0, 198},
		{1, 196},
		{4, 80},
		{0, 197},
		{1, 195},
		{3, 108},
		{2, 150},
		{0, 196},
		{2, 149},
		{4, 73},
		{0, 195},
		{2, 147},
		{3, 105},
		{0, 194},
		{4, 68},
		{2, 144},
		{0, 193},
		{0, 193},
		{5, 6},
		{2, 142},
		{2, 141},
		{4, 3},
		{5, 7},
		{0, 191},
		{5, 22},
		{3, 100},
		{5, 8},
		{1, 189},
		{2, 1},
		{0, 189},
		{4, 61},
		{3, 97},
		{3, 2},
		{5, 18},
		{3, 93},
		{3, 92},
		{4, 56},
		{4, 55},
		{3, 91},
		{2, 136},
		{3, 89},
		{3, 88},
		{3, 88},
		{2, 135},
		{0, 186},
		{4, 45},
		{1, 186},
		{3, 86},
		{2, 132},
		{1, 185},
		{2, 131},
		{4, 43},
	};
};

#endif // VACTROLS_H