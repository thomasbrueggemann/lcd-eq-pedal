#ifndef VACTROLS_H
#define VACTROLS_H

#include <Arduino.h>
#include <SPI.h>

#include "MCP4261.h"
#include "Preset.h"

#define ADDRESS 0x11

#define LOOKUP_PWM_IDX 0
#define LOOKUP_POT_IDX 1

#define TREBLE_POT_CS 24
#define TREBLE_PWM1_PIN 11
#define TREBLE_PWM2_PIN 12

#define MID_POT_CS 23
#define MID_PWM1_PIN 9
#define MID_PWM2_PIN 10

#define BASS_POT_CS 22
#define BASS_PWM1_PIN 7
#define BASS_PWM2_PIN 8

#define VOLUME_POT_CS 25
#define VOLUME_PWM1_PIN 13

class Vactrols
{
public:
	// Constructor
	Vactrols();

	void ApplyPreset(Preset &preset);

	void SetBass(int value);
	void SetMiddle(int value);
	void SetTreble(int value);
	void SetVolume(int value);

private:
	void setDoubleVactrol(int value, MCP4261 &digipot, int pwm1Pin, int pwm2Pin, int vactrolLookup[256][4]);

	MCP4261 bassPot;
	MCP4261 midPot;
	MCP4261 treblePot;

	int VolumeLookup[256][2] = {
		{251, 0},
		{187, 0},
		{122, 2},
		{147, 5},
		{215, 12},
		{40, 3},
		{130, 18},
		{41, 6},
		{91, 22},
		{53, 12},
		{42, 13},
		{55, 22},
		{102, 36},
		{125, 51},
		{83, 46},
		{126, 60},
		{131, 71},
		{136, 79},
		{59, 53},
		{117, 83},
		{23, 26},
		{33, 42},
		{81, 83},
		{95, 87},
		{84, 92},
		{109, 109},
		{128, 132},
		{114, 133},
		{71, 95},
		{115, 136},
		{22, 50},
		{56, 96},
		{18, 42},
		{57, 99},
		{33, 77},
		{16, 42},
		{51, 103},
		{74, 136},
		{106, 177},
		{43, 101},
		{72, 147},
		{84, 169},
		{94, 180},
		{101, 202},
		{41, 114},
		{54, 140},
		{32, 101},
		{25, 84},
		{41, 121},
		{34, 114},
		{18, 78},
		{21, 90},
		{12, 57},
		{23, 95},
		{60, 182},
		{42, 147},
		{46, 162},
		{8, 50},
		{38, 151},
		{79, 238},
		{23, 108},
		{81, 242},
		{65, 220},
		{51, 200},
		{75, 254},
		{22, 115},
		{23, 123},
		{39, 171},
		{39, 176},
		{47, 198},
		{51, 224},
		{21, 122},
		{51, 220},
		{21, 127},
		{14, 102},
		{51, 227},
		{40, 200},
		{39, 196},
		{22, 140},
		{12, 95},
		{49, 235},
		{32, 182},
		{35, 196},
		{6, 61},
		{50, 250},
		{46, 244},
		{21, 152},
		{46, 245},
		{23, 164},
		{2, 26},
		{15, 126},
		{11, 103},
		{20, 154},
		{20, 164},
		{20, 160},
		{8, 86},
		{41, 255},
		{33, 226},
		{10, 103},
		{20, 171},
		{24, 188},
		{38, 253},
		{23, 189},
		{26, 212},
		{13, 134},
		{4, 57},
		{12, 130},
		{22, 195},
		{4, 58},
		{10, 116},
		{4, 61},
		{23, 202},
		{6, 83},
		{15, 157},
		{1, 20},
		{22, 203},
		{15, 163},
		{7, 97},
		{29, 249},
		{6, 88},
		{8, 111},
		{10, 128},
		{19, 202},
		{13, 156},
		{26, 245},
		{14, 171},
		{6, 96},
		{17, 189},
		{5, 83},
		{7, 108},
		{14, 177},
		{19, 210},
		{15, 182},
		{9, 132},
		{1, 24},
		{4, 76},
		{3, 60},
		{1, 25},
		{10, 147},
		{6, 107},
		{2, 45},
		{4, 80},
		{6, 108},
		{8, 131},
		{13, 181},
		{4, 81},
		{2, 48},
		{18, 227},
		{3, 67},
		{20, 248},
		{5, 98},
		{7, 125},
		{9, 151},
		{6, 114},
		{8, 143},
		{6, 117},
		{17, 233},
		{9, 154},
		{10, 166},
		{1, 29},
		{2, 52},
		{6, 120},
		{4, 91},
		{7, 136},
		{1, 31},
		{7, 138},
		{10, 175},
		{4, 92},
		{3, 77},
		{5, 112},
		{9, 165},
		{9, 170},
		{14, 229},
		{4, 96},
		{15, 240},
		{12, 208},
		{6, 131},
		{1, 33},
		{7, 147},
		{13, 225},
		{8, 162},
		{8, 165},
		{1, 34},
		{7, 157},
		{4, 106},
		{1, 35},
		{10, 197},
		{9, 182},
		{3, 84},
		{12, 221},
		{10, 198},
		{9, 184},
		{3, 85},
		{6, 146},
		{4, 107},
		{1, 37},
		{8, 176},
		{4, 109},
		{4, 108},
		{12, 233},
		{9, 193},
		{6, 152},
		{3, 90},
		{13, 250},
		{9, 198},
		{2, 68},
		{11, 224},
		{11, 228},
		{5, 136},
		{6, 158},
		{1, 40},
		{7, 174},
		{6, 155},
		{1, 41},
		{6, 159},
		{2, 70},
		{3, 96},
		{8, 195},
		{3, 98},
		{2, 72},
		{6, 160},
		{1, 42},
		{5, 142},
		{4, 123},
		{5, 143},
		{10, 230},
		{4, 124},
		{4, 126},
		{11, 248},
		{1, 43},
		{4, 125},
		{5, 148},
		{2, 76},
		{4, 129},
		{1, 44},
		{7, 191},
		{3, 104},
		{1, 45},
		{7, 195},
		{1, 46},
		{8, 212},
		{3, 107},
		{6, 176},
		{3, 108},
		{5, 155},
		{6, 178},
		{1, 47},
		{6, 177},
		{2, 80},
		{7, 202},
		{2, 81},
		{10, 254},
		{6, 182},
		{5, 159},
		{8, 223}};

	int TrebleLookup[256][4] = {
		{251, 0, 1, 179},
		{40, 3, 1, 179},
		{42, 13, 1, 179},
		{126, 60, 1, 179},
		{23, 26, 1, 179},
		{109, 109, 1, 179},
		{22, 50, 1, 179},
		{16, 42, 1, 176},
		{72, 147, 1, 176},
		{54, 140, 1, 176},
		{18, 78, 1, 176},
		{42, 147, 1, 176},
		{23, 108, 1, 176},
		{22, 115, 1, 176},
		{51, 224, 1, 176},
		{51, 227, 1, 176},
		{49, 235, 1, 176},
		{46, 244, 1, 176},
		{15, 126, 1, 176},
		{8, 86, 1, 175},
		{24, 188, 1, 175},
		{4, 57, 1, 175},
		{4, 61, 1, 175},
		{22, 203, 1, 175},
		{8, 111, 1, 175},
		{14, 171, 1, 175},
		{14, 177, 1, 175},
		{4, 76, 1, 160},
		{2, 45, 1, 160},
		{4, 81, 1, 160},
		{5, 98, 1, 160},
		{6, 117, 1, 160},
		{2, 52, 1, 162},
		{7, 138, 1, 162},
		{9, 165, 1, 162},
		{12, 208, 1, 162},
		{8, 162, 1, 162},
		{1, 35, 1, 162},
		{10, 198, 1, 162},
		{1, 37, 1, 166},
		{9, 193, 1, 166},
		{2, 68, 1, 166},
		{1, 40, 1, 166},
		{2, 70, 1, 166},
		{6, 160, 1, 166},
		{10, 230, 1, 166},
		{4, 125, 1, 157},
		{7, 191, 1, 157},
		{8, 212, 1, 157},
		{6, 178, 1, 157},
		{2, 81, 1, 157},
		{5, 164, 1, 157},
		{4, 141, 1, 151},
		{1, 51, 1, 151},
		{6, 196, 1, 151},
		{9, 255, 1, 151},
		{2, 90, 1, 151},
		{5, 182, 1, 156},
		{4, 157, 1, 156},
		{3, 128, 1, 156},
		{2, 96, 1, 153},
		{3, 132, 1, 153},
		{5, 193, 1, 153},
		{1, 59, 1, 153},
		{2, 104, 1, 145},
		{3, 143, 1, 145},
		{4, 175, 1, 145},
		{2, 106, 1, 145},
		{3, 144, 1, 145},
		{1, 64, 1, 146},
		{2, 111, 1, 146},
		{2, 112, 1, 146},
		{2, 114, 1, 146},
		{3, 155, 1, 146},
		{1, 70, 1, 141},
		{5, 226, 1, 141},
		{1, 71, 1, 141},
		{3, 161, 1, 141},
		{1, 73, 1, 141},
		{2, 122, 1, 137},
		{1, 75, 1, 137},
		{1, 74, 1, 137},
		{2, 128, 1, 137},
		{2, 129, 1, 140},
		{1, 77, 1, 140},
		{2, 133, 1, 140},
		{1, 78, 1, 140},
		{1, 80, 1, 140},
		{1, 81, 2, 222},
		{2, 135, 2, 222},
		{1, 82, 2, 222},
		{2, 137, 2, 222},
		{1, 83, 1, 131},
		{1, 83, 1, 131},
		{4, 231, 1, 131},
		{2, 145, 1, 131},
		{2, 147, 1, 130},
		{1, 87, 1, 130},
		{1, 88, 1, 130},
		{1, 89, 1, 125},
		{1, 89, 1, 125},
		{2, 151, 1, 125},
		{1, 90, 1, 125},
		{3, 208, 1, 124},
		{2, 153, 1, 124},
		{3, 210, 1, 124},
		{1, 93, 1, 124},
		{1, 94, 1, 124},
		{2, 161, 2, 203},
		{1, 95, 2, 203},
		{1, 95, 2, 203},
		{1, 96, 2, 203},
		{1, 96, 2, 203},
		{1, 99, 1, 123},
		{1, 99, 1, 120},
		{1, 100, 1, 120},
		{3, 227, 1, 118},
		{1, 101, 1, 118},
		{1, 101, 1, 118},
		{1, 103, 1, 114},
		{1, 103, 1, 114},
		{2, 177, 1, 114},
		{2, 177, 1, 111},
		{1, 107, 1, 111},
		{1, 107, 1, 113},
		{1, 106, 1, 113},
		{1, 106, 1, 113},
		{1, 106, 2, 182},
		{2, 182, 2, 182},
		{2, 182, 1, 106},
		{1, 113, 1, 106},
		{1, 113, 1, 106},
		{1, 113, 1, 107},
		{1, 111, 1, 107},
		{1, 111, 2, 177},
		{1, 114, 2, 177},
		{1, 114, 1, 103},
		{1, 114, 1, 103},
		{1, 118, 1, 101},
		{1, 118, 1, 101},
		{1, 118, 3, 227},
		{1, 120, 1, 100},
		{1, 120, 1, 99},
		{1, 123, 1, 99},
		{2, 203, 1, 96},
		{2, 203, 1, 96},
		{2, 203, 1, 95},
		{2, 203, 1, 95},
		{2, 203, 2, 161},
		{1, 124, 1, 94},
		{1, 124, 1, 93},
		{1, 124, 3, 210},
		{1, 124, 2, 153},
		{1, 124, 3, 208},
		{1, 125, 1, 90},
		{1, 125, 2, 151},
		{1, 125, 1, 89},
		{1, 125, 1, 89},
		{1, 130, 1, 88},
		{1, 130, 1, 87},
		{1, 130, 2, 147},
		{1, 131, 2, 145},
		{1, 131, 4, 231},
		{1, 131, 1, 83},
		{1, 131, 1, 83},
		{2, 222, 2, 137},
		{2, 222, 1, 82},
		{2, 222, 2, 135},
		{2, 222, 1, 81},
		{1, 140, 1, 80},
		{1, 140, 1, 78},
		{1, 140, 2, 133},
		{1, 140, 1, 77},
		{1, 140, 2, 129},
		{1, 137, 2, 128},
		{1, 137, 1, 74},
		{1, 137, 1, 75},
		{1, 137, 2, 122},
		{1, 141, 1, 73},
		{1, 141, 3, 161},
		{1, 141, 1, 71},
		{1, 141, 5, 226},
		{1, 141, 1, 70},
		{1, 146, 3, 155},
		{1, 146, 2, 114},
		{1, 146, 2, 112},
		{1, 146, 2, 111},
		{1, 146, 1, 64},
		{1, 145, 3, 144},
		{1, 145, 2, 106},
		{1, 145, 4, 175},
		{1, 145, 3, 143},
		{1, 145, 2, 104},
		{1, 153, 1, 59},
		{1, 153, 5, 193},
		{1, 153, 3, 132},
		{1, 153, 2, 96},
		{1, 156, 3, 128},
		{1, 156, 4, 157},
		{1, 156, 5, 182},
		{1, 151, 2, 90},
		{1, 151, 9, 255},
		{1, 151, 6, 196},
		{1, 151, 1, 51},
		{1, 151, 4, 141},
		{1, 157, 5, 164},
		{1, 157, 2, 81},
		{1, 157, 6, 178},
		{1, 157, 8, 212},
		{1, 157, 7, 191},
		{1, 157, 4, 125},
		{1, 166, 10, 230},
		{1, 166, 6, 160},
		{1, 166, 2, 70},
		{1, 166, 1, 40},
		{1, 166, 2, 68},
		{1, 166, 9, 193},
		{1, 166, 1, 37},
		{1, 162, 10, 198},
		{1, 162, 1, 35},
		{1, 162, 8, 162},
		{1, 162, 12, 208},
		{1, 162, 9, 165},
		{1, 162, 7, 138},
		{1, 162, 2, 52},
		{1, 160, 6, 117},
		{1, 160, 5, 98},
		{1, 160, 4, 81},
		{1, 160, 2, 45},
		{1, 160, 4, 76},
		{1, 175, 14, 177},
		{1, 175, 14, 171},
		{1, 175, 8, 111},
		{1, 175, 22, 203},
		{1, 175, 4, 61},
		{1, 175, 4, 57},
		{1, 175, 24, 188},
		{1, 175, 8, 86},
		{1, 176, 15, 126},
		{1, 176, 46, 244},
		{1, 176, 49, 235},
		{1, 176, 51, 227},
		{1, 176, 51, 224},
		{1, 176, 22, 115},
		{1, 176, 23, 108},
		{1, 176, 42, 147},
		{1, 176, 18, 78},
		{1, 176, 54, 140},
		{1, 176, 72, 147},
		{1, 176, 16, 42},
		{1, 179, 22, 50},
		{1, 179, 109, 109},
		{1, 179, 23, 26},
		{1, 179, 126, 60},
		{1, 179, 42, 13}};

	int BassMiddleLookup[256][4] = {
		{251, 0, 1, 90},
		{122, 2, 1, 90},
		{215, 12, 2, 151},
		{130, 18, 2, 151},
		{91, 22, 2, 151},
		{42, 13, 2, 151},
		{102, 36, 1, 89},
		{83, 46, 1, 89},
		{131, 71, 1, 89},
		{59, 53, 4, 240},
		{23, 26, 4, 240},
		{81, 83, 1, 88},
		{84, 92, 1, 88},
		{128, 132, 1, 87},
		{71, 95, 1, 87},
		{22, 50, 2, 147},
		{18, 42, 2, 147},
		{33, 77, 2, 145},
		{51, 103, 2, 145},
		{106, 177, 2, 145},
		{72, 147, 4, 231},
		{94, 180, 4, 231},
		{41, 114, 1, 84},
		{32, 101, 1, 83},
		{41, 121, 1, 83},
		{18, 78, 1, 83},
		{12, 57, 1, 83},
		{60, 182, 2, 137},
		{46, 162, 2, 137},
		{38, 151, 2, 137},
		{23, 108, 1, 82},
		{65, 220, 1, 82},
		{75, 254, 1, 82},
		{23, 123, 2, 135},
		{39, 176, 2, 135},
		{51, 224, 2, 135},
		{51, 220, 1, 81},
		{14, 102, 2, 134},
		{40, 200, 2, 134},
		{22, 140, 1, 80},
		{49, 235, 1, 78},
		{35, 196, 1, 78},
		{50, 250, 2, 133},
		{21, 152, 2, 133},
		{23, 164, 1, 77},
		{15, 126, 1, 77},
		{20, 154, 1, 77},
		{20, 160, 2, 129},
		{41, 255, 2, 129},
		{10, 103, 2, 129},
		{24, 188, 2, 128},
		{23, 189, 2, 128},
		{13, 134, 1, 76},
		{12, 130, 1, 76},
		{4, 58, 1, 74},
		{4, 61, 2, 125},
		{6, 83, 1, 75},
		{1, 20, 2, 122},
		{15, 163, 2, 122},
		{29, 249, 2, 122},
		{8, 111, 1, 73},
		{19, 202, 1, 73},
		{26, 245, 4, 198},
		{6, 96, 3, 161},
		{5, 83, 1, 71},
		{14, 177, 1, 71},
		{15, 182, 1, 71},
		{1, 24, 1, 72},
		{3, 60, 2, 118},
		{10, 147, 5, 226},
		{2, 45, 1, 68},
		{6, 108, 1, 70},
		{13, 181, 1, 70},
		{2, 48, 5, 221},
		{3, 67, 3, 155},
		{5, 98, 3, 154},
		{9, 151, 2, 114},
		{8, 143, 4, 186},
		{17, 233, 2, 112},
		{10, 166, 1, 67},
		{2, 52, 1, 67},
		{4, 91, 2, 111},
		{1, 31, 1, 66},
		{10, 175, 1, 64},
		{3, 77, 1, 64},
		{9, 165, 1, 63},
		{14, 229, 3, 144},
		{15, 240, 2, 109},
		{6, 131, 5, 209},
		{7, 147, 2, 106},
		{8, 162, 4, 175},
		{1, 34, 4, 175},
		{4, 106, 2, 103},
		{10, 197, 3, 143},
		{3, 84, 2, 105},
		{10, 198, 5, 200},
		{3, 85, 2, 104},
		{4, 107, 1, 60},
		{8, 176, 5, 198},
		{4, 108, 1, 59},
		{9, 193, 3, 133},
		{3, 90, 5, 193},
		{9, 198, 1, 58},
		{11, 224, 3, 132},
		{5, 136, 7, 237},
		{1, 40, 2, 97},
		{6, 155, 2, 96},
		{6, 159, 1, 57},
		{3, 96, 4, 158},
		{3, 98, 3, 128},
		{6, 160, 1, 56},
		{5, 142, 4, 157},
		{5, 143, 6, 204},
		{4, 124, 1, 54},
		{11, 248, 1, 53},
		{4, 125, 3, 122},
		{2, 76, 2, 90},
		{1, 44, 4, 151},
		{3, 104, 9, 255},
		{7, 195, 3, 121},
		{8, 212, 1, 52},
		{6, 176, 6, 196},
		{5, 155, 4, 146},
		{1, 47, 2, 86},
		{2, 80, 6, 192},
		{2, 81, 1, 49},
		{6, 182, 4, 141},
		{8, 223, 4, 140},
		{5, 164, 5, 164},
		{4, 140, 8, 223},
		{4, 141, 6, 182},
		{1, 49, 2, 81},
		{6, 192, 2, 80},
		{2, 86, 1, 47},
		{4, 146, 5, 155},
		{6, 196, 6, 176},
		{1, 52, 8, 212},
		{3, 121, 7, 195},
		{9, 255, 3, 104},
		{4, 151, 1, 44},
		{2, 90, 2, 76},
		{3, 122, 4, 125},
		{1, 53, 11, 248},
		{1, 54, 4, 124},
		{6, 204, 5, 143},
		{4, 157, 5, 142},
		{1, 56, 6, 160},
		{3, 128, 3, 98},
		{4, 158, 3, 96},
		{1, 57, 6, 159},
		{2, 96, 6, 155},
		{2, 97, 1, 40},
		{7, 237, 5, 136},
		{3, 132, 11, 224},
		{1, 58, 9, 198},
		{5, 193, 3, 90},
		{3, 133, 9, 193},
		{1, 59, 4, 108},
		{5, 198, 8, 176},
		{1, 60, 4, 107},
		{2, 104, 3, 85},
		{5, 200, 10, 198},
		{2, 105, 3, 84},
		{3, 143, 10, 197},
		{2, 103, 4, 106},
		{4, 175, 1, 34},
		{4, 175, 8, 162},
		{2, 106, 7, 147},
		{5, 209, 6, 131},
		{2, 109, 15, 240},
		{3, 144, 14, 229},
		{1, 63, 9, 165},
		{1, 64, 3, 77},
		{1, 64, 10, 175},
		{1, 66, 1, 31},
		{2, 111, 4, 91},
		{1, 67, 2, 52},
		{1, 67, 10, 166},
		{2, 112, 17, 233},
		{4, 186, 8, 143},
		{2, 114, 9, 151},
		{3, 154, 5, 98},
		{3, 155, 3, 67},
		{5, 221, 2, 48},
		{1, 70, 13, 181},
		{1, 70, 6, 108},
		{1, 68, 2, 45},
		{5, 226, 10, 147},
		{2, 118, 3, 60},
		{1, 72, 1, 24},
		{1, 71, 15, 182},
		{1, 71, 14, 177},
		{1, 71, 5, 83},
		{3, 161, 6, 96},
		{4, 198, 26, 245},
		{1, 73, 19, 202},
		{1, 73, 8, 111},
		{2, 122, 29, 249},
		{2, 122, 15, 163},
		{2, 122, 1, 20},
		{1, 75, 6, 83},
		{2, 125, 4, 61},
		{1, 74, 4, 58},
		{1, 76, 12, 130},
		{1, 76, 13, 134},
		{2, 128, 23, 189},
		{2, 128, 24, 188},
		{2, 129, 10, 103},
		{2, 129, 41, 255},
		{2, 129, 20, 160},
		{1, 77, 20, 154},
		{1, 77, 15, 126},
		{1, 77, 23, 164},
		{2, 133, 21, 152},
		{2, 133, 50, 250},
		{1, 78, 35, 196},
		{1, 78, 49, 235},
		{1, 80, 22, 140},
		{2, 134, 40, 200},
		{2, 134, 14, 102},
		{1, 81, 51, 220},
		{2, 135, 51, 224},
		{2, 135, 39, 176},
		{2, 135, 23, 123},
		{1, 82, 75, 254},
		{1, 82, 65, 220},
		{1, 82, 23, 108},
		{2, 137, 38, 151},
		{2, 137, 46, 162},
		{2, 137, 60, 182},
		{1, 83, 12, 57},
		{1, 83, 18, 78},
		{1, 83, 41, 121},
		{1, 83, 32, 101},
		{1, 84, 41, 114},
		{4, 231, 94, 180},
		{4, 231, 72, 147},
		{2, 145, 106, 177},
		{2, 145, 51, 103},
		{2, 145, 33, 77},
		{2, 147, 18, 42},
		{2, 147, 22, 50},
		{1, 87, 71, 95},
		{1, 87, 128, 132},
		{1, 88, 84, 92},
		{1, 88, 81, 83},
		{4, 240, 23, 26},
		{4, 240, 59, 53},
		{1, 89, 131, 71},
		{1, 89, 83, 46},
		{1, 89, 102, 36},
		{2, 151, 42, 13},
		{2, 151, 91, 22},
		{2, 151, 130, 18},
		{2, 151, 215, 12}};
};

#endif // VACTROLS_H