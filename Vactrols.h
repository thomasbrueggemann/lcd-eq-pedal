#ifndef VACTROLS_H
#define VACTROLS_H

#include <Arduino.h>
#include <SPI.h>

#include "MCP4261.h"
#include "Preset.h"

#define ADDRESS 0x11

#define LOOKUP_PWM_IDX 0
#define LOOKUP_POT_IDX 1

#define TREBLE_POT_CS 24
#define TREBLE_PWM1_PIN 11
#define TREBLE_PWM2_PIN 12

#define MID_POT_CS 23
#define MID_PWM1_PIN 9
#define MID_PWM2_PIN 10

#define BASS_POT_CS 22
#define BASS_PWM1_PIN 7
#define BASS_PWM2_PIN 8

#define VOLUME_POT_CS 25
#define VOLUME_PWM1_PIN 13

class Vactrols
{
public:
	// Constructor
	Vactrols();

	void ApplyPreset(Preset &preset);

	void SetBass(int value);
	void SetMiddle(int value);
	void SetTreble(int value);
	void SetVolume(int value);

private:
	void setDoubleVactrol(int value, MCP4261 &digipot, int pwm1Pin, int pwm2Pin, int vactrolLookup[256][2]);

	MCP4261 bassPot;
	MCP4261 midPot;
	MCP4261 treblePot;

	int VolumeLookup[256][2] = {
		{251, 0},
		{187, 0},
		{122, 2},
		{147, 5},
		{215, 12},
		{40, 3},
		{130, 18},
		{41, 6},
		{91, 22},
		{53, 12},
		{42, 13},
		{55, 22},
		{102, 36},
		{125, 51},
		{83, 46},
		{126, 60},
		{131, 71},
		{136, 79},
		{59, 53},
		{117, 83},
		{23, 26},
		{33, 42},
		{81, 83},
		{95, 87},
		{84, 92},
		{109, 109},
		{128, 132},
		{114, 133},
		{71, 95},
		{115, 136},
		{22, 50},
		{56, 96},
		{18, 42},
		{57, 99},
		{33, 77},
		{16, 42},
		{51, 103},
		{74, 136},
		{106, 177},
		{43, 101},
		{72, 147},
		{84, 169},
		{94, 180},
		{101, 202},
		{41, 114},
		{54, 140},
		{32, 101},
		{25, 84},
		{41, 121},
		{34, 114},
		{18, 78},
		{21, 90},
		{12, 57},
		{23, 95},
		{60, 182},
		{42, 147},
		{46, 162},
		{8, 50},
		{38, 151},
		{79, 238},
		{23, 108},
		{81, 242},
		{65, 220},
		{51, 200},
		{75, 254},
		{22, 115},
		{23, 123},
		{39, 171},
		{39, 176},
		{47, 198},
		{51, 224},
		{21, 122},
		{51, 220},
		{21, 127},
		{14, 102},
		{51, 227},
		{40, 200},
		{39, 196},
		{22, 140},
		{12, 95},
		{49, 235},
		{32, 182},
		{35, 196},
		{6, 61},
		{50, 250},
		{46, 244},
		{21, 152},
		{46, 245},
		{23, 164},
		{2, 26},
		{15, 126},
		{11, 103},
		{20, 154},
		{20, 164},
		{20, 160},
		{8, 86},
		{41, 255},
		{33, 226},
		{10, 103},
		{20, 171},
		{24, 188},
		{38, 253},
		{23, 189},
		{26, 212},
		{13, 134},
		{4, 57},
		{12, 130},
		{22, 195},
		{4, 58},
		{10, 116},
		{4, 61},
		{23, 202},
		{6, 83},
		{15, 157},
		{1, 20},
		{22, 203},
		{15, 163},
		{7, 97},
		{29, 249},
		{6, 88},
		{8, 111},
		{10, 128},
		{19, 202},
		{13, 156},
		{26, 245},
		{14, 171},
		{6, 96},
		{17, 189},
		{5, 83},
		{7, 108},
		{14, 177},
		{19, 210},
		{15, 182},
		{9, 132},
		{1, 24},
		{4, 76},
		{3, 60},
		{1, 25},
		{10, 147},
		{6, 107},
		{2, 45},
		{4, 80},
		{6, 108},
		{8, 131},
		{13, 181},
		{4, 81},
		{2, 48},
		{18, 227},
		{3, 67},
		{20, 248},
		{5, 98},
		{7, 125},
		{9, 151},
		{6, 114},
		{8, 143},
		{6, 117},
		{17, 233},
		{9, 154},
		{10, 166},
		{1, 29},
		{2, 52},
		{6, 120},
		{4, 91},
		{7, 136},
		{1, 31},
		{7, 138},
		{10, 175},
		{4, 92},
		{3, 77},
		{5, 112},
		{9, 165},
		{9, 170},
		{14, 229},
		{4, 96},
		{15, 240},
		{12, 208},
		{6, 131},
		{1, 33},
		{7, 147},
		{13, 225},
		{8, 162},
		{8, 165},
		{1, 34},
		{7, 157},
		{4, 106},
		{1, 35},
		{10, 197},
		{9, 182},
		{3, 84},
		{12, 221},
		{10, 198},
		{9, 184},
		{3, 85},
		{6, 146},
		{4, 107},
		{1, 37},
		{8, 176},
		{4, 109},
		{4, 108},
		{12, 233},
		{9, 193},
		{6, 152},
		{3, 90},
		{13, 250},
		{9, 198},
		{2, 68},
		{11, 224},
		{11, 228},
		{5, 136},
		{6, 158},
		{1, 40},
		{7, 174},
		{6, 155},
		{1, 41},
		{6, 159},
		{2, 70},
		{3, 96},
		{8, 195},
		{3, 98},
		{2, 72},
		{6, 160},
		{1, 42},
		{5, 142},
		{4, 123},
		{5, 143},
		{10, 230},
		{4, 124},
		{4, 126},
		{11, 248},
		{1, 43},
		{4, 125},
		{5, 148},
		{2, 76},
		{4, 129},
		{1, 44},
		{7, 191},
		{3, 104},
		{1, 45},
		{7, 195},
		{1, 46},
		{8, 212},
		{3, 107},
		{6, 176},
		{3, 108},
		{5, 155},
		{6, 178},
		{1, 47},
		{6, 177},
		{2, 80},
		{7, 202},
		{2, 81},
		{10, 254},
		{6, 182},
		{5, 159},
		{8, 223}};

	int TrebleLookup[256][2] = {
		{251, 0},
		{40, 3},
		{42, 13},
		{126, 60},
		{23, 26},
		{109, 109},
		{22, 50},
		{16, 42},
		{72, 147},
		{54, 140},
		{18, 78},
		{42, 147},
		{23, 108},
		{22, 115},
		{51, 224},
		{51, 227},
		{49, 235},
		{46, 244},
		{15, 126},
		{8, 86},
		{24, 188},
		{4, 57},
		{4, 61},
		{22, 203},
		{8, 111},
		{14, 171},
		{14, 177},
		{4, 76},
		{2, 45},
		{4, 81},
		{5, 98},
		{6, 117},
		{2, 52},
		{7, 138},
		{9, 165},
		{12, 208},
		{8, 162},
		{1, 35},
		{10, 198},
		{1, 37},
		{9, 193},
		{2, 68},
		{1, 40},
		{2, 70},
		{6, 160},
		{10, 230},
		{4, 125},
		{7, 191},
		{8, 212},
		{6, 178},
		{2, 81},
		{5, 164},
		{4, 141},
		{1, 51},
		{6, 196},
		{9, 255},
		{2, 90},
		{5, 182},
		{4, 157},
		{3, 128},
		{2, 96},
		{3, 132},
		{5, 193},
		{1, 59},
		{2, 104},
		{3, 143},
		{4, 175},
		{2, 106},
		{3, 144},
		{1, 64},
		{2, 111},
		{2, 112},
		{2, 114},
		{3, 155},
		{1, 70},
		{5, 226},
		{1, 71},
		{3, 161},
		{1, 73},
		{2, 122},
		{1, 75},
		{1, 74},
		{2, 128},
		{2, 129},
		{1, 77},
		{2, 133},
		{1, 78},
		{1, 80},
		{1, 81},
		{2, 135},
		{1, 82},
		{2, 137},
		{1, 83},
		{1, 83},
		{4, 231},
		{2, 145},
		{2, 147},
		{1, 87},
		{1, 88},
		{1, 89},
		{1, 89},
		{2, 151},
		{1, 90},
		{3, 208},
		{2, 153},
		{3, 210},
		{1, 93},
		{1, 94},
		{2, 161},
		{1, 95},
		{1, 95},
		{1, 96},
		{1, 96},
		{1, 99},
		{1, 99},
		{1, 100},
		{3, 227},
		{1, 101},
		{1, 101},
		{1, 103},
		{1, 103},
		{2, 177},
		{2, 177},
		{1, 107},
		{1, 107},
		{1, 106},
		{1, 106},
		{1, 106},
		{2, 182},
		{2, 182},
		{1, 113},
		{1, 113},
		{1, 113},
		{1, 111},
		{1, 111},
		{1, 114},
		{1, 114},
		{1, 114},
		{1, 118},
		{1, 118},
		{1, 118},
		{1, 120},
		{1, 120},
		{1, 123},
		{2, 203},
		{2, 203},
		{2, 203},
		{2, 203},
		{2, 203},
		{1, 124},
		{1, 124},
		{1, 124},
		{1, 124},
		{1, 124},
		{1, 125},
		{1, 125},
		{1, 125},
		{1, 125},
		{1, 130},
		{1, 130},
		{1, 130},
		{1, 131},
		{1, 131},
		{1, 131},
		{1, 131},
		{2, 222},
		{2, 222},
		{2, 222},
		{2, 222},
		{1, 140},
		{1, 140},
		{1, 140},
		{1, 140},
		{1, 140},
		{1, 137},
		{1, 137},
		{1, 137},
		{1, 137},
		{1, 141},
		{1, 141},
		{1, 141},
		{1, 141},
		{1, 141},
		{1, 146},
		{1, 146},
		{1, 146},
		{1, 146},
		{1, 146},
		{1, 145},
		{1, 145},
		{1, 145},
		{1, 145},
		{1, 145},
		{1, 153},
		{1, 153},
		{1, 153},
		{1, 153},
		{1, 156},
		{1, 156},
		{1, 156},
		{1, 151},
		{1, 151},
		{1, 151},
		{1, 151},
		{1, 151},
		{1, 157},
		{1, 157},
		{1, 157},
		{1, 157},
		{1, 157},
		{1, 157},
		{1, 166},
		{1, 166},
		{1, 166},
		{1, 166},
		{1, 166},
		{1, 166},
		{1, 166},
		{1, 162},
		{1, 162},
		{1, 162},
		{1, 162},
		{1, 162},
		{1, 162},
		{1, 162},
		{1, 160},
		{1, 160},
		{1, 160},
		{1, 160},
		{1, 160},
		{1, 175},
		{1, 175},
		{1, 175},
		{1, 175},
		{1, 175},
		{1, 175},
		{1, 175},
		{1, 175},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 176},
		{1, 179},
		{1, 179},
		{1, 179},
		{1, 179},
		{1, 179}};

	int BassMiddleLookup[256][2] = {
		{251, 0},
		{122, 2},
		{215, 12},
		{130, 18},
		{91, 22},
		{42, 13},
		{102, 36},
		{83, 46},
		{131, 71},
		{59, 53},
		{23, 26},
		{81, 83},
		{84, 92},
		{128, 132},
		{71, 95},
		{22, 50},
		{18, 42},
		{33, 77},
		{51, 103},
		{106, 177},
		{72, 147},
		{94, 180},
		{41, 114},
		{32, 101},
		{41, 121},
		{18, 78},
		{12, 57},
		{60, 182},
		{46, 162},
		{38, 151},
		{23, 108},
		{65, 220},
		{75, 254},
		{23, 123},
		{39, 176},
		{51, 224},
		{51, 220},
		{14, 102},
		{40, 200},
		{22, 140},
		{49, 235},
		{35, 196},
		{50, 250},
		{21, 152},
		{23, 164},
		{15, 126},
		{20, 154},
		{20, 160},
		{41, 255},
		{10, 103},
		{24, 188},
		{23, 189},
		{13, 134},
		{12, 130},
		{4, 58},
		{4, 61},
		{6, 83},
		{1, 20},
		{15, 163},
		{29, 249},
		{8, 111},
		{19, 202},
		{26, 245},
		{6, 96},
		{5, 83},
		{14, 177},
		{15, 182},
		{1, 24},
		{3, 60},
		{10, 147},
		{2, 45},
		{6, 108},
		{13, 181},
		{2, 48},
		{3, 67},
		{5, 98},
		{9, 151},
		{8, 143},
		{17, 233},
		{10, 166},
		{2, 52},
		{4, 91},
		{1, 31},
		{10, 175},
		{3, 77},
		{9, 165},
		{14, 229},
		{15, 240},
		{6, 131},
		{7, 147},
		{8, 162},
		{1, 34},
		{4, 106},
		{10, 197},
		{3, 84},
		{10, 198},
		{3, 85},
		{4, 107},
		{8, 176},
		{4, 108},
		{9, 193},
		{3, 90},
		{9, 198},
		{11, 224},
		{5, 136},
		{1, 40},
		{6, 155},
		{6, 159},
		{3, 96},
		{3, 98},
		{6, 160},
		{5, 142},
		{5, 143},
		{4, 124},
		{11, 248},
		{4, 125},
		{2, 76},
		{1, 44},
		{3, 104},
		{7, 195},
		{8, 212},
		{6, 176},
		{5, 155},
		{1, 47},
		{2, 80},
		{2, 81},
		{6, 182},
		{8, 223},
		{5, 164},
		{4, 140},
		{4, 141},
		{1, 49},
		{6, 192},
		{2, 86},
		{4, 146},
		{6, 196},
		{1, 52},
		{3, 121},
		{9, 255},
		{4, 151},
		{2, 90},
		{3, 122},
		{1, 53},
		{1, 54},
		{6, 204},
		{4, 157},
		{1, 56},
		{3, 128},
		{4, 158},
		{1, 57},
		{2, 96},
		{2, 97},
		{7, 237},
		{3, 132},
		{1, 58},
		{5, 193},
		{3, 133},
		{1, 59},
		{5, 198},
		{1, 60},
		{2, 104},
		{5, 200},
		{2, 105},
		{3, 143},
		{2, 103},
		{4, 175},
		{4, 175},
		{2, 106},
		{5, 209},
		{2, 109},
		{3, 144},
		{1, 63},
		{1, 64},
		{1, 64},
		{1, 66},
		{2, 111},
		{1, 67},
		{1, 67},
		{2, 112},
		{4, 186},
		{2, 114},
		{3, 154},
		{3, 155},
		{5, 221},
		{1, 70},
		{1, 70},
		{1, 68},
		{5, 226},
		{2, 118},
		{1, 72},
		{1, 71},
		{1, 71},
		{1, 71},
		{3, 161},
		{4, 198},
		{1, 73},
		{1, 73},
		{2, 122},
		{2, 122},
		{2, 122},
		{1, 75},
		{2, 125},
		{1, 74},
		{1, 76},
		{1, 76},
		{2, 128},
		{2, 128},
		{2, 129},
		{2, 129},
		{2, 129},
		{1, 77},
		{1, 77},
		{1, 77},
		{2, 133},
		{2, 133},
		{1, 78},
		{1, 78},
		{1, 80},
		{2, 134},
		{2, 134},
		{1, 81},
		{2, 135},
		{2, 135},
		{2, 135},
		{1, 82},
		{1, 82},
		{1, 82},
		{2, 137},
		{2, 137},
		{2, 137},
		{1, 83},
		{1, 83},
		{1, 83},
		{1, 83},
		{1, 84},
		{4, 231},
		{4, 231},
		{2, 145},
		{2, 145},
		{2, 145},
		{2, 147},
		{2, 147},
		{1, 87},
		{1, 87},
		{1, 88},
		{1, 88},
		{4, 240},
		{4, 240},
		{1, 89},
		{1, 89},
		{1, 89},
		{2, 151},
		{2, 151},
		{2, 151},
		{2, 151}};
};

#endif // VACTROLS_H